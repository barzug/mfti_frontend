<!DOCTYPE html>
<html lang="ru">

<head>
	<title>Введение во Frontend</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="icon" type="image/png" href="/lib/favicon.png" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="/lib/shower/themes/styles/screen-4x3.css">
	<link rel="stylesheet" href="/lib/slides.css">

</head>

<body class="shower list">

	<header class="caption">
		<h1>Full-stack разработка</h1>
		<p>МФТИ</p>
	</header>

	<section class="slide first">
		<h2 class="shout">Семинар №4<br />
			<small>Слайды доступны по ссылке<br />
				<a href="https://mfti-frontend.herokuapp.com/">mfti-frontend.herokuapp.com</a>
			</small>
		</h2>
	</section>

	<section class="slide">
		<h2 class="shout">Cookies</h2>
	</section>

	<section class="slide question">
		<h2>HTTP is a stateless protocol</h2>
	</section>

	<section class="slide">
		<h2>Cookies</h2>
		<div>
			<blockquote>
				<p class="small-content"><b>Куки (cookies)</b> &mdash; небольшой фрагмент данных, отправленный веб-сервером и
					хранимый на компьютере пользователя. Веб-клиент (обычно веб-браузер) всякий раз при попытке открыть страницу
					соответствующего сайта пересылает этот фрагмент данных веб-серверу в виде HTTP-запроса</p>
			</blockquote>
		</div>
	</section>

	<section class="slide">
		<h2><a href="http://tools.ietf.org/html/rfc2965">Спецификация</a> cookies</h2>
		<p class="small-content"></p>
		<ul lang="ru">
			<li>Браузер должен хранить как минимум 4096 байт кук</li>
			<li>Минимум 20 шт. на домен</li>
			<li>Минимум 300 шт. всего</li>
			<li>Имена <mark>нечувствительны</mark> к регистру</li>
		</ul>
	</section>

	<section class="slide">
		<h2>1 Клиент → Сервер</h2>
		<pre class="hljs http">
			<code>GET / HTTP/1.1</code>
			<code>Host: example.com</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>2 Клиент ← Сервер</h2>
		<pre class="hljs http">
			<code>HTTP/1.1 200 OK</code>
			<code><mark>Set-Cookie: name=value</mark></code>
			<code>Content-Type: text/html</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>3 Клиент → Сервер</h2>
		<pre class="hljs http">
			<code>GET / HTTP/1.1</code>
			<code>Host: example.com</code>
			<code><mark>Cookie: name=value</mark></code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>4 Клиент ← Сервер</h2>
		<pre class="hljs http">
			<code>HTTP/1.1 200 OK</code>
			<code><mark>Set-Cookie: name=value2</mark></code>
			<code>Content-Type: text/html</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>Использование</h2>
		<p class="small-content"></p>
		<ul lang="ru">
			<li>Аутентификация пользователей</li>
			<li>Хранение настроек пользователей</li>
			<li>Отслеживание сеанса (сессия)</li>
			<li>Сбор статистики</li>
			<li>Проведение экспериментов</li>
			<li>etc...</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Set-Cookie</h2>
		<pre class="hljs http">
			<code>Set-Cookie: value</code>
			<code>                 [;<span hidden>X:</span> Expires=date]</code>
			<code>                 [;<span hidden>X:</span> Max-Age=age]</code>
			<code>                 [;<span hidden>X:</span> Domain=domain]</code>
			<code>                 [;<span hidden>X:</span> Path=path]</code>
			<code>                 [;<span hidden>X:</span> Secure]</code>
			<code>                 [;<span hidden>X:</span> HttpOnly]</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>Cookie ID</h2>
		<pre class="hljs http">
			<code>Set-Cookie: name=v1; domain=.example.com; path=/</code>
			<code>Set-Cookie: name=v2; domain=www.example.com; path=/</code>
			<code>Set-Cookie: name=v3; domain=.example.com; path=/archive</code>
			<code> </code>
		</pre>
		<pre class="hljs http">
			<code>Cookie: name=v1; name=v2; name=v3</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>JavaScript</h2>
		<p class="small-content"></p>
		<pre class="hljs js">
			<code>document.cookie; /* 'name1=value1' */</code>
			<code class="next">document.cookie = 'name2=value2';</code>
			<code class="next">document.cookie; /* 'name1=value1; name2=value2' */</code>
			<code> </code>
		</pre>
	</section>

	<!-- <section class="slide">
		<h2>Credentials вместе с XHR</h2>
		<p class="small-content"></p>
		<pre class="hljs js">
			<code>const xhr = new XMLHttpRequest();</code>
			<code>xhr.open('GET', '/auth', <mark>true</mark>);</code>
			<code> </code>
			<code>xhr.withCredentials = true; // отправляем cookies</code>
			<code> </code>
			<code>xhr.send();</code>
			<code> </code>
		</pre>
	</section> -->

	<section class="slide">
		<h2>Итого: авторизация через куки</h2>
		<ul lang="ru">
			<li><strong>Клиент не работает с куками</strong></li>
			<li>При запуске приложения, отправляем запрос за текущим пользователем</li>
			<li>Если <mark>на бекенд</mark> приходит запрос без кук &mdash; значит пользователь не авторизован, возвращаем 401
			</li>
			<li>Если <mark>на бекенд</mark> приходит запрос c куками &mdash; значит пользователь авторизован, возвращаем 200
			</li>
			<li>На <mark>клиенте</mark>, в зависимости от ответа сервера, рисуем либо профиль пользователя, либо форму
				авторизации</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Same Origin Policy</h2>
		<blockquote>
			<p class="medium-content"><b>Правило ограничения домена (Same Origin Policy &mdash; «Принцип одинакового
					источника» a.k.a. «Политика единого источника»)</b> &mdash; это важная концепция безопасности и работы
				web-приложений. Она призвана
				<mark>ограничивать возможности</mark> пользовательских сценариев из определённого источника по доступу к
				ресурсам и информации из других
				источников</p>
		</blockquote>
		<p class="note"><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy"
				target="_blank">Подробнее</a></p>
	</section>

	<section class="slide">
		<h2>Same Origin Policy</h2>
		<p>Вводится понятие
			<mark>источника</mark>
			(адрес в интернете, откуда был загружен&nbsp;ресурс). Два URL считаются имеющим один источник («same origin»),
			если у
			них
			<mark>одинаковый протокол, домен и порт</mark>
		</p>
		<p>У этих ресурсов одинаковые источники:</p>
		<ul>
			<li><code>http://site.com</code></li>
			<li><code>http://site.com/</code></li>
			<li><code>http://site.com/my/page.html</code></li>
		</ul>
	</section>

	<section class="slide">
		<h2>Same Origin Policy</h2>
		<p>У этих ресурсов <strong>разные</strong> источники:</p>
		<ul>
			<li><code>http://site.com</code></li>
			<li><code>http://<strong>www</strong>.site.com</code> (другой домен)</li>
			<li><code>http://site.<strong>org</strong></code> (другой домен)</li>
			<li><code><strong>https</strong>://site.com</code> (другой протокол)</li>
			<li><code>http://site.com:<strong>8080</strong></code> (другой порт)</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Типы взаимодействия с ресурсами</h2>
		<p>Любой способ взаимодействия с ресурсами в web-приложениях можно отнести к одной из трёх категорий:</p>
		<ul>
			<li><mark><strong>"Запись" в ресурсы</strong></mark> &mdash; например: переходы по ссылкам, редиректы, сабмит
				форм, отправка запросов</li>
			<li><mark><strong>"Встраивание" ресурсов в другие ресурсы</strong></mark>:
				<ul>
					<li>JavaScript with <code>&lt;script src="...">&lt;/script></code></li>
					<li>CSS with <code>&lt;link rel="stylesheet" href="..."></code></li>
					<li>Images with <code>&lt;img></code>, media files with <code>&lt;video></code> and <code>&lt;audio></code>
					</li>
					<li>Plug-ins with <code>&lt;object></code>, <code>&lt;embed></code> and <code>&lt;applet></code></li>
				</ul>
			</li>
			<li><mark><strong>"Чтение" из других ресурсов</strong></mark> &mdash; например: чтение ответов на запросы,
				получение доступа к содержимому встроенного ресурса...</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Same Origin Policy</h2>
		<p class="small-content"></p>
		<ul>
			<li>Cross Origin "Запись" в ресурсы обычно разрешается (<em>за некоторыми исключениями, о них чуть позже</em>)
			</li>
			<li>Cross Origin "Встраивание" ресурсов обычно разрешается</li>
			<li>Cross Origin "Чтение" из других ресурсов по-умолчанию запрещено</li>
		</ul>
	</section>

	<section class="slide question">
		<h2><span style="font-size: 80%; display: inline-block;">Как законно обойти ограничения Same Origin Policy?</span>
		</h2>
	</section>

	<section class="slide">
		<h2>Архитектура приложений</h2>
		<div style="position:relative;width: 100%; height: 75%;">
			<img class="place" src="arch.png" style="transform-origin: center;transform: translate(-50.45%,-51%) scale(.55);">
		</div>
	</section>

	<section class="slide">
		<h2>HTTP access control (CORS)</h2>
		<p class="medium-content"></p>
		<blockquote>
			<p class="small-content"><b>Cross-Origin Resource Sharing (CORS) standard</b> &mdash; спецификация,
				позволяющая обойти ограничения, которые Same Origin Policy накладывает на кросс-доменные запросы</p>
		</blockquote>
		<p class="note"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank">Подробнее</a></p>
	</section>

	<section class="slide">
		<h2>Cross Origin HTTP-запросы (
			<mark>XHR</mark>
			)
		</h2>
		<pre class="hljs js">
		<code>// Находимся на https://evil.com/</code>
		<code>const xhr = new XMLHttpRequest();</code>
		<code>xhr.open('GET', <mark>'https://e.mail.ru/messages/inbox/'</mark>, false);</code>
		<code>xhr.send();</code>
		<code> </code>
		<code>console.log(xhr.responseText)</code>
		<code> </code>
	</pre>
	</section>

	<section class="slide">
		<h2>Запросы делятся на два типа</h2>
		<p>Простыми считаются запросы, если они удовлетворяют следующим двум условиям:</p>
		<ul>
			<li>Простой метод: GET, POST или HEAD</li>
			<li>Простые заголовки &mdash; только из списка:
				<ul>
					<li><code>Accept</code></li>
					<li><code>Accept-Language</code></li>
					<li><code>Content-Language</code></li>
					<li><code>Content-Type</code>
						<ul>
							<li><code>application/x-www-form-urlencoded</code></li>
							<li><code>multipart/form-data</code></li>
							<li><code>text/plain</code></li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>CORS для простых запросов</h2>
		<pre class="hljs http">
			<code>GET /data HTTP/1.1</code>
			<code>Host: e.mail.ru</code>
			<code>Origin: http://frontend.tech-mail.ru</code>
			<code> </code>
		</pre>
		<pre class="hljs http">
			<code>HTTP/1.1 200 OK</code>
			<code>Content-Type: text/html; charset=UTF-8</code>
			<code><mark>Access-Control-Allow-Origin:</mark> http://frontend.tech-mail.ru</code>
			<code>// Access-Control-Allow-Origin: *</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>CORS для простых запросов:<br />дополнительные заголовки</h2>
		<pre class="hljs http">
			<code>HTTP/1.1 200 OK</code>
			<code>Content-Type: text/html; charset=UTF-8</code>
			<code>Access-Control-Allow-Origin: http://frontend.tech-mail.ru</code>
			<code>...</code>
			<code>X-UID: 42</code>
			<code>X-Secret: 2c9de507f2c54aa1</code>
			<code><mark>Access-Control-Expose-Headers:</mark> X-Uid, X-Authentication</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>CORS для простых запросов:<br />данные авторизации</h2>
		<pre class="hljs js">
			<code>const xhr = new XMLHttpRequest();</code>
			<code>xhr.<mark>withCredentials</mark> = true;</code>
			<code>xhr.open('GET', 'https://e.mail.ru/messages/inbox/', false);</code>
			<code> </code>
		</pre>
		<pre class="hljs http">
			<code>HTTP/1.1 200 OK</code>
			<code>Content-Type: text/html; charset=UTF-8</code>
			<code>Access-Control-Allow-Origin: <mark>domain</mark> // '*' запрещено</code>
			<code><mark>Access-Control-Allow-Credentials:</mark> true</code>
			<code> </code>
		</pre>
	</section>

	<section class="slide">
		<h2>Запросы делятся на два типа</h2>
		<p class="small-content">Остальные запросы считаются
			<mark>"непростыми"</mark>
			, и при отправке таких запросов необходимо понять, согласен ли сервер на обработку таких запросов. Эти запросы
			всегда отсылаются со специальным заголовком <code>Origin</code></p>
	</section>

	<section class="slide">
		<h2>"Непростые" запросы</h2>
		<p>При отправке "непростого" запроса, браузер сделает на самом деле <strong>два</strong> HTTP-запроса.
			<ul>
				<li>«Предзапрос» (английский термин «preflight») OPTIONS. Cодержит название желаемого метода в заголовке
					<code>Access-Control-Request-Method</code>,
					а если добавлены особые заголовки, то и их тоже &mdash; в <code>Access-Control-Request-Headers</code>.
				</li>
				<li>Основной HTTP-запрос с заголовком <code>Origin</code></li>
			</ul>
	</section>

	<section class="slide">
		<h2>"Непростые" запросы</h2>
		<p>Ответ на предзапрос может содержать следующие заголовки</p>
		<pre class="hljs http">
			<code>HTTP/1.1 200 OK</code>
			<code>Content-Type: text/plain</code>
			<code><mark>Access-Control-Allow-Methods:</mark> DELETE, PUT, HEAD, OPTIONS, GET, POST</code>
			<code><mark>Access-Control-Allow-Headers:</mark> Content-Type, User-Agent ...</code>
			<code>         ... X-Requested-With, If-Modified-Since, Cache-Control</code>
			<code><mark>Access-Control-Max-Age:</mark> 86400</code>
			<code> </code>
		</pre>
	</section>


	<!--закончили с Безопасностью-->


	<section class="slide">
		<h2 class="shout">Работа с API</h2>
	</section>

	<section class="slide">
		<h2>Что есть
			<mark>API</mark>
		</h2>
		<blockquote>
			<p class="medium-content"><b>API (application programming interface, интерфейс программирования приложений)</b>
				&mdash; набор готовых классов, процедур, функций, структур и констант, предоставляемых приложением
				(библиотекой, сервисом) или операционной системой для использования во внешних программных продуктах.
				Используется программистами при написании всевозможных приложений</p>
		</blockquote>
	</section>

	<section class="slide">
		<h2>Что есть
			<mark>API</mark>
		</h2>
		<p>API определяет
			<mark>функциональность</mark>
			, которую предоставляет программа (модуль, библиотека), при этом API позволяет абстрагироваться от того, как
			именно эта функциональность реализована
		</p>
		<p><b>Web API</b> &mdash; используется в веб-разработке, как правило, определённый набор HTTP-запросов, а также
			определение
			<mark>структуры</mark>
			HTTP-ответов, для выражения которых используют XML или JSON форматы
		</p>
	</section>

	<section class="slide">
		<h2>Сема́нтика</h2>
		<blockquote>
			<p><b>Сема́нтика</b> &mdash; раздел лингвистики, изучающий смысловое значение единиц языка</p>
		</blockquote>
		<p><br />
			&ndash; <em>Работодатель:</em> Назовите вашу главную слабость <br />
			&ndash; <em>Кандидат:</em> Я даю
			<mark>семантически</mark>
			корректные, но практически неприменимые ответы на вопросы <br />
			&ndash; <em>Работодатель:</em> Могли бы вы привести пример? <br />
			&ndash; <em>Кандидат:</em> Да, мог бы
		</p>
	</section>

	<section class="slide">
		<h2>CRUD</h2>
		<blockquote>
			<p><b>CRUD (create, read, update, delete)</b> &mdash; акроним, обозначающий четыре базовые функции, используемые
				при работе с персистентными хранилищами данных, описывает семантику методов HTTP</p>
		</blockquote>
		<ul>
			<li>GET (чтение данных)</li>
			<li>POST (создание данных)</li>
			<li>PUT (полное обновление данных) или PATCH (частичное обновление данных)</li>
			<li>DELETE (удаление данных)</li>
			<li>HEAD запрашивает ресурс так же, как и GET, но без тела ответа</li>
			<li>OPTIONS используется для описания параметров соединения с ресурсом</li>
		</ul>
	</section>

	<section class="slide">
		<h2>REST</h2>
		<blockquote>
			<p><b>REST (в применении к именованию ресурсов)</b> &mdash; набор методик и практик, которые используются для
				именования ресурсов, с которыми работает система</p>
		</blockquote>
		<p>Все типы ресурсов делятся на две категории:</p>
		<ul>
			<li>
				<mark>коллекции ресурсов</mark> &mdash; имеют имя
			</li>
			<li>
				<mark>отдельные представители</mark> &mdash; принадлежат к какой-то коллекции и имеют идентификатор, чтобы
				отличать различных представителей коллекции друг от друга
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>REST</h2>
		<p>Коллекция книг (books):</p>
		<ul>
			<li>Вся коллекция получает URI <code>/books</code></li>
			<li>Идентификатор книги &mdash; её ISBN. Отдельные книги:
				<ul>
					<li><code>/books/2-266-11156-6</code></li>
					<li><code>/books/3-720-55486-7</code></li>
					<li><code>/books/1-054-55901-2</code></li>
				</ul>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>REST</h2>
		<p>Коллекция пользователей (users):</p>
		<ul>
			<li>Вся коллекция получает URI <code>/users</code></li>
			<li>Идентификатор пользователя &mdash; его ID. Отдельные пользователи:
				<ul>
					<li><code>/users/id2</code></li>
					<li><code>/users/id432</code></li>
					<li><code>/users/id1211177181</code></li>
				</ul>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>REST + CRUD = семантическое API</h2>
		<pre class="hljs http">
		<code>Получение всех книг</code>
		<code>GET /books HTTP/1.1</code>
		<code>Host: awesome.com</code>
		<code> </code>
		<code>Получение конкретной книги</code>
		<code>GET /books/3-720-55486-7 HTTP/1.1</code>
		<code>Host: awesome.com</code>
		<code> </code>
		<code>Удаление конкретной книги</code>
		<code>DELETE /books/3-720-55486-7 HTTP/1.1</code>
		<code>Host: awesome.com</code>
		<code> </code>
	</pre>
	</section>

	<section class="slide">
		<h2>Документирование API</h2>
		<p class="small-content"></p>
		<ul>
			<li><a href="http://swagger.io/" target="_blank">swagger</a></li>
			<li><a href="https://apiary.io/" target="_blank">apiary</a></li>
			<li><a href="https://apiblueprint.org/" target="_blank">apiblueprint</a></li>
			<li>Ваши варианты ;)</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Другие способы организации API</h2>
		<p class="small-content"></p>
		<ul>
			<li><a href="https://ru.wikipedia.org/wiki/JSON-RPC" target="_blank">JSON-RPC</a></li>
			<li><a href="https://habr.com/post/326986/" target="_blank">GraphQL</a></li>
			<li>Ваши варианты ;)</li>
		</ul>
	</section>

	<section class="slide">
		<h2 class="shout">Всем спасибо!</h2>
	</section>

	<div class="progress"></div>
	<script src="/lib/shower/shower.min.js"></script>
	<script src="/lib/hljs/highlight.pack.js"></script>
	<script>
		hljs.initHighlightingOnLoad();
	</script>
</body>

</html>